/* ===== THEME (aprox. Daggerheart) ===== */
:root {
  --dh-bg: #15131b;
  --dh-surface: #1f1b2a;
  --dh-panel: #2b2536;
  --dh-border: #3b3248;
  --dh-text: #f5f5f7;
  --dh-muted: #c9c3d7;
  --dh-accent: #f2c24b;
  --dh-accent-ink: #2b220a;
  --dhud-ring-main: none;
  --dhud-ring-weapon: none;
}

/* Themes */
body.dhud-theme-default  { --dh-accent:#f0b400; --dh-surface:#15161a; --dh-border:rgba(255,255,255,0.12); }
body.dhud-theme-crimson  { --dh-accent:#d12a2a; --dh-surface:#1a0e10; --dh-border:rgba(255,180,180,0.18); }
body.dhud-theme-emerald  { --dh-accent:#10a37f; --dh-surface:#0d1412; --dh-border:rgba(170,255,220,0.16); }
body.dhud-theme-midnight { --dh-accent:#6aa3ff; --dh-surface:#0a101b; --dh-border:rgba(180,210,255,0.16); }

/* Toggled by settings: document.body.classList.toggle('dhud-hide-hotbar', ...) */
body.dhud-hide-hotbar #hotbar { display: none !important; }

.dhud { background-color: var(--dhud-bg); }
.dhud .accent { color: var(--dhud-accent); }

/* ===== Remove “janela” e clipping do Application V2 ===== */
.daggerheart-hud.window-app,
.daggerheart-hud.application {
  border: 0 !important;
  box-shadow: none !important;
  background: transparent !important;
  overflow: visible !important;      /* evita cortar popovers */
}
.daggerheart-hud .window-header { display: none !important; }
.daggerheart-hud .window-content {
  background: transparent !important;
  padding: 0 !important;
  overflow: visible !important;
}
.daggerheart-hud .window-resizable-handle { display: none !important; }

/* ===== Layout shell ===== */
.dhud { color: var(--dh-text); }
.dhud--layout {
  position: relative;
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
  gap: .75rem;
}

/* ===== Wings ===== */
.dhud-wing { position: relative; display: flex; gap: .5rem; align-items: center; }
.dhud-wing--left  { justify-content: flex-end; }
.dhud-wing--right { justify-content: flex-start; }

.dhud-tab {
  position: relative;
  padding: .38rem .9rem;
  font-weight: 800;
  letter-spacing: .06em;
  border: 2px solid var(--dh-border);
  border-radius: 6px;
  background: var(--dh-surface);
  box-shadow: inset 0 -1px 0 rgba(255,255,255,.06);
  cursor: pointer;
  user-select: none;
  text-transform: uppercase;
}
.dhud-tab:hover,
.dhud-tab:active,
.dhud-tab:focus { border-color: var(--dh-accent); }

/* Panels (popover above tab) */
.dhud-tabwrap { position: relative; }
.dhud-panel {
  --panel-w: 320px;
  position: absolute;
  left: 0; right: auto;
  bottom: calc(100% + .5rem);
  width: var(--panel-w);
  max-height: 300px; overflow: auto;
  background: var(--dh-panel);
  border: 2px solid var(--dh-border);
  border-radius: 12px;
  padding: .6rem .7rem;
  box-shadow: 0 14px 36px rgba(0,0,0,.5);
  display: none;
  z-index: 500;                /* sobre o app */
}
.dhud-tabwrap--right .dhud-panel { left: auto; right: 0; }
.dhud-panel header {
  font-weight: 900;
  margin-bottom: .5rem;
  margin: 10px 5px;
  padding-bottom: 2px;
  border-bottom: 1px solid var(--dh-accent);
}

/* Open-state controlado por [data-open] no root */
.dhud[data-open="traits"]    #panel-traits,
.dhud[data-open="ancestry"]  #panel-ancestry,
.dhud[data-open="inventory"] #panel-inventory,
.dhud[data-open="domains"]   #panel-domains,
.dhud[data-open="class"]     #panel-class,
.dhud[data-open="loadout"]   #panel-loadout,
.dhud[data-open="vault"]     #panel-vault { display: block; }

/* ===== Accordion (itens dos painéis) ===== */
.dhud-acc { list-style: none; margin: 0; padding: 0; display: grid; gap: .4rem; }

/* Keep each accordion row on a single line and push controls to the right */
.dhud-acc summary {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: nowrap;   
  padding: 4px 8px;
  border: 1px solid var(--dh-border);
  border-radius: 4px;
}

/* Icon stays fixed size */
.dhud-acc summary .icon {
  width: 20px; height: 20px;
  flex: 0 0 auto;
}

/* Title takes remaining space, truncates with ellipsis if too long */
.dhud-acc summary .title {
  flex: 1 1 auto;
  min-width: 0; 
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Small chips stay inline and non-wrapping */
.dhud-acc summary .qty,
.dhud-acc summary .recall {
  flex: 0 0 auto;
  white-space: nowrap;
}

/* Action icons on the far right */
.dhud-acc summary .move,
.dhud-acc summary .chat {
  flex: 0 0 auto;
  margin-left: 0.4rem;
}

/* ===== Core (anel central e círculos laterais) ===== */
.dhud-core {
  /* tamanhos principais */
  --circle-d: 110px;
  --side-d: 75px;
  --pip: 12px;

  /* spacing e fórmulas */
  --core-gap: .05rem; 
  --overlap: 8px;   
  --badge-inset: 8px; 

  /* offsets de HP/Stress (ajuste só aqui) */
  --hp-top: -6px;
  --hp-left: 34px;
  --stress-top: -6px;
  --stress-right: 34px;

  display: grid;
  grid-template-columns: var(--side-d) var(--circle-d) var(--side-d);
  align-items: center;
  justify-items: center;
  gap: var(--core-gap);
  position: relative;
}

/* ordem entre wrappers (resolve stacking contexts com transform) */
.dhud-core__leftcircle,
.dhud-core__rightcircle { position: relative; z-index: 1; }
.dhud-core__center      { position: relative; z-index: 2; }  /* ring acima */

/* Side circles com ícone do item */
.dhud-circle {
  width: var(--side-d);
  height: var(--side-d);
  /* border: 3px solid var(--dh-border); */
  border-radius: 999px;
  /* background: var(--dh-surface); */

  /* optional frame art from settings */
  background-image: var(--dhud-ring-weapon, none);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;

  display: grid;
  place-items: center;
  position: relative;
  z-index: 1;
  pointer-events: auto;
}
.dhud-circle .item-icon { position: relative; z-index: 2; }

.dhud-roll { cursor: pointer; }
.dhud-roll:hover { border-color: var(--dh-accent); }
.dhud-circle .item-icon {
  width: 95%; height: 95%;
  object-fit: cover;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,.5));
  border: none;
  border-radius: 999px;
}

/* aproximação dos círculos laterais */
.dhud-core__leftcircle  { transform: translateX(var(--overlap)); }
.dhud-core__rightcircle { transform: translateX(calc(-1 * var(--overlap))); }

/* Anel central */
.dhud-core__center {

  pointer-events: none;

  display: grid;
  grid-template-areas:
    "ring"
    "th";
  align-items: center;
  justify-items: center;
  row-gap: .25rem;
}

.dhud-ring {
  grid-area: ring;
  position: relative;
  width: var(--circle-d);
  height: var(--circle-d);
  /* border: 6px solid var(--dh-border); */
  border-radius: 999px;
  display: grid;
  place-items: center;

  /* one circle: use surface (no art) OR the configured frame art */
  /* background: var(--dh-surface); */
  background-image: var(--dhud-ring-main, none);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;

  z-index: 2;
  pointer-events: auto;
  cursor: grab;
}
.dhud-ring:active { cursor: grabbing; }

.dhud-ring img {border: none}


.dhud-portrait {
  width: calc(var(--circle-d) - 28px);
  height: calc(var(--circle-d) - 28px);
  border-radius: 999px; overflow: hidden;
  border: 3px solid var(--dh-border); 
  pointer-events: auto; 
}
.dhud-portrait-img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 999px;
  z-index: 1;
  display: block;
}
/* Hope pips */
.dhud-pips {
  position: absolute;
  inset: 0;
  z-index: 2;
  pointer-events: none;
}

/* default (empty) pip */
.dhud-pips .pip {
  width: var(--pip); height: var(--pip);
  border: 2px solid var(--dh-border);
  border-radius: 999px;
  background: transparent;
  opacity: 0.7;  
  transition: background .15s, border-color .15s, opacity .15s;
}

/* filled pip */
.dhud-pips .pip.filled {
  background: var(--dh-accent);
  opacity: 1;
}

/* HP / Stress (absolutos; clicáveis para futuros +/-) */
.dhud-count {
  position: absolute;
  white-space: nowrap;
  text-align: center;
  pointer-events: auto; 
}
.dhud-count--hp {
  top: var(--hp-top);
  left: var(--hp-left);
  text-align: left;
}
.dhud-count--stress {
  top: var(--stress-top);
  right: var(--stress-right);
  text-align: right;
}

/* Thresholds:  */
.dhud-thresholds {
  grid-area: th;
  grid-column: 1 / -1;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: .5rem;
  margin-top: .25rem;
  pointer-events: none;
}
.dhud-thresholds .chip {
  background: var(--dh-accent);
  color: var(--dh-accent-ink);
  padding: .12rem .5rem;
  border-radius: 8px;
  font-weight: 900;
  letter-spacing: .04em;
}
.dhud-thresholds .val {
  padding: .1rem .45rem;
  border: 1px solid var(--dh-border);
  border-radius: 8px;
  background: var(--dh-surface);
  color: var(--dh-text);
  font-weight: 800;
  min-width: 2.2ch;
  text-align: center;
}

/* Badges  */
.dhud-badge {
  position: absolute;
  top: 50%;
  transform: translateY(0%);
  z-index: 3;          
  pointer-events: none;   
  width: 40px; height: 40px;
  display: grid; place-items: center;
  font-weight: 800; font-size: .8rem;
}

.dhud-badge--left {
  left: calc(var(--side-d) + var(--core-gap) - 20px + var(--badge-inset));
  background-image: url("/modules/daggerheart-hud/ui/shield.svg");
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
}
.dhud-badge--right {
  left: calc(var(--side-d) + var(--core-gap) + var(--circle-d) - 20px - var(--badge-inset));
  background-image: url("/modules/daggerheart-hud/ui/armor.svg");
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
}

/* ---- Wings open/close animation ---- */
.dhud--layout {
  --wing-shift: 28px;                       /* slide distance */
  --wing-duration: 220ms;
  --wing-ease: cubic-bezier(.2,.8,.2,1);
}

/* transition for both wings */
.dhud-wing {
  transition:
    transform var(--wing-duration) var(--wing-ease),
    opacity   var(--wing-duration) var(--wing-ease);
  will-change: transform, opacity;
}

/* Hide any open panel while wings are retracted */
.dhud--layout[data-wings="closed"] .dhud-panel {
  display: none !important;
}

/* Default state = CLOSED (you'll set it via JS on first render) */
.dhud--layout[data-wings="closed"] { grid-template-columns: 0 auto 0; }
.dhud--layout[data-wings="closed"] .dhud-wing--left  { opacity:0; transform:translateX(-28px); pointer-events:none; }
.dhud--layout[data-wings="closed"] .dhud-wing--right { opacity:0; transform:translateX( 28px); pointer-events:none; }
.dhud--layout[data-wings="open"] .dhud-wing { opacity:1; transform:none; pointer-events:auto; }

/* Make sure stacking order is: wings > core */
.dhud--layout { position: relative; }

.dhud-core  { position: relative; z-index: 10; }
.dhud-wing  { position: relative; z-index: 30; }  /* wings above core */
.dhud-panel { position: absolute; z-index: 40; }  /* panels above everything in the HUD */


/* ===== Responsivo ===== */
@media (max-width: 980px) {
  /* opcional: reduza levemente em telas menores */
  .dhud-core { --circle-d: 100px; --side-d: 68px; }
  .dhud-panel { --panel-w: 280px; }
}
